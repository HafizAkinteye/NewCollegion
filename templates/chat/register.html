{% extends 'chat/index.html' %}
{% block form %}
    <h3>
    Register
    </h3>
    <form id="register-form" class="form-group">
        {% csrf_token %}
        <div class="row">
            <div class="input-field col s12">
                <input name="username" id="id_username" type="text" class="validate">
                <label for="id_username" data-error="Username already taken">Username</label>
            </div>
        </div>
        <div class="row">
            <div class="input-field col s12">
                <input name="email" id="id_email" type="text" class="validate">
                <label for="id_email" data-error="Email already used">Email</label>
            </div>
        </div>
        <div class="row">
            <div class="input-field col s12">
                <input name="password" id="id_password" type="password">
                <label for="id_password">Password</label>
            </div>
        </div>
        <div class="row">
            <div class="input-field col s12">
                <input name="password2" id="id_password2" type="password">
                <label for="id_password2">Repeat Password</label>
            </div>
        </div>
        <div class="row">
            <div class="col s12">
            <div class="right">
                <button class="btn blue waves-effect waves-light pull-s12">Register</button>
            </div>
        </div>
    </form>
    <script>
$(function () {
    $('#register-form').on('submit', function (event)
    {
        event.preventDefault();
        // Set variables
        var username = $('#id_username').val();
        var email = $('#id_email').val();
        var password = $('#id_password').val();
        let isEduEmail = /^[a-zA-Z0-9.!#$%&'*+=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[e][d][u](?:[e][d][u]{0,61}[a-zA-Z0-9])?)*$/;
        let matchedEmail = isEduEmail.test(email);
        // Implement guard clause for readability.
        if(username === '')
        {
            return alert("Please enter a username.");
        }
        // Check if password is entered
        if(password === '')
        {
            return alert("Please enter a valid password");
        }
        console.log(email)
        console.log(password === $('#id_password2').val())
        console.log(matchedEmail)
        if(matchedEmail == false)
        {
            return alert("Please enter a valid email ending in .edu")
        }
        // Register user if passwords match
        if(password === $('#id_password2').val())
        {
            register (username, email, password);
        }
        else
        {
            return alert("Please ensure your passwords are matching");
        }
    })
})
    </script>
{% endblock %}